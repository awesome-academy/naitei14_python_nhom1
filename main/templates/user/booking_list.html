{% extends 'main/base.html' %} {% load i18n %} {% block title %}{% trans
"Booking History" %}{% endblock %} {% block content %}
<h2>{% trans "Booking History" %}</h2>

<!-- Filter by status -->
<div class="mb-3">
  <a
    href="{% url 'user_booking_list' %}"
    class="btn btn-sm btn-outline-primary {% if not status_filter %}active{% endif %}"
  >
    {% trans "All" %}
  </a>
  {% for status_code, status_name in booking_statuses %}
  <a
    href="?status={{ status_code }}"
    class="btn btn-sm btn-outline-primary {% if status_filter == status_code %}active{% endif %}"
  >
    {{ status_name }}
  </a>
  {% endfor %}
</div>

<!-- Bookings Table -->
{% if page_obj %}
<div class="table-responsive">
  <table class="table table-hover">
    <thead>
      <tr>
        {% if is_admin %}
        <th>{% trans "User" %}</th>
        {% endif %}
        <th>{% trans "Pitch" %}</th>
        <th>{% trans "Date" %}</th>
        <th>{% trans "Time Slot" %}</th>
        <th>{% trans "Duration" %}</th>
        <th>{% trans "Price" %}</th>
        <th>{% trans "Status" %}</th>
        <th>{% trans "Actions" %}</th>
      </tr>
    </thead>
    <tbody>
      {% for booking in page_obj %}
      <tr>
        {% if is_admin %}
        <td>{{ booking.user.username }}</td>
        {% endif %}
        <td>
          <strong>{{ booking.pitch.name }}</strong>
        </td>
        <td>{{ booking.booking_date|date:"d/m/Y" }}</td>
        <td>
          <strong>{{ booking.time_slot.time_slot.name }}</strong><br />
          <small class="text-muted">
            {{ booking.time_slot.time_slot.start_time|time:"H:i" }} - {{
            booking.time_slot.time_slot.end_time|time:"H:i" }}
          </small>
        </td>
        <td>
          {% blocktrans count hours=booking.duration_hours %} {{ hours }} hour
          {% plural %} {{ hours }} hours {% endblocktrans %}
        </td>
        <td>
          <strong>{{ booking.final_price|floatformat:0 }}Ä‘</strong>
          {% if booking.voucher %}
          <br /><span class="badge bg-success"
            >-{{ booking.voucher.discount_percent }}%</span
          >
          {% endif %}
        </td>
        <td>
          {% if booking.status == BOOKING_STATUS_PENDING %}
          <span class="badge bg-warning">{{ booking.get_status_display }}</span>
          {% elif booking.status == BOOKING_STATUS_CONFIRMED %}
          <span class="badge bg-success">{{ booking.get_status_display }}</span>
          {% elif booking.status == BOOKING_STATUS_CANCELLED %}
          <span class="badge bg-secondary">{{ booking.get_status_display }}</span>
          {% else %}
          <span class="badge bg-danger">{{ booking.get_status_display }}</span>
          {% endif %}
        </td>
        <td>
            <a href="{% url 'user_booking_detail' booking.id %}" class="btn btn-sm btn-outline-secondary">
                {% trans "View" %}
            </a>
            {% if booking.status == BOOKING_STATUS_PENDING %}
            <form method="post" action="{% url 'user_booking_cancel' booking.id %}" class="d-inline">
                {% csrf_token %}
                <button type="submit" class="btn btn-sm btn-outline-danger"
                    onclick="return confirm('{% trans "Are you sure you want to cancel this booking?" %}');">
                    {% trans "Cancel" %}
                </button>
            </form>
            {% endif %}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<!-- Pagination -->
{% if page_obj.has_other_pages %}
<nav>
  <ul class="pagination">
    {% if page_obj.has_previous %}
    <li class="page-item">
      <a
        class="page-link"
        href="?page={{ page_obj.previous_page_number }}{% if status_filter %}&status={{ status_filter }}{% endif %}"
      >
        {% trans "Previous" %}
      </a>
    </li>
    {% endif %}

    <li class="page-item active">
      <span class="page-link">
        {% blocktrans with current=page_obj.number
        total=page_obj.paginator.num_pages %} Page {{ current }} / {{ total }}
        {% endblocktrans %}
      </span>
    </li>

    {% if page_obj.has_next %}
    <li class="page-item">
      <a
        class="page-link"
        href="?page={{ page_obj.next_page_number }}{% if status_filter %}&status={{ status_filter }}{% endif %}"
      >
        {% trans "Next" %}
      </a>
    </li>
    {% endif %}
  </ul>
</nav>
{% endif %} {% else %}
<div class="alert alert-info">
  <i class="fas fa-info-circle"></i> {% trans "You have no bookings yet." %}
  <a href="{% url 'pitch_list' %}" class="alert-link"
    >{% trans "Book a pitch now" %}</a
  >
</div>
{% endif %} {% endblock %}
